-- ClassTypes: à¸™à¸´à¸¢à¸²à¸¡ Character Classes à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”

export type ClassDefinition = {
	id: string,
	name: string,
	description: string,
	icon: string,
	color: Color3,
	-- Stats modifiers (multipliers)
	walkSpeedMod: number,
	jumpPowerMod: number,
	-- Special abilities
	knockbackResistance: number, -- 0-1 (1 = full immunity)
	-- Passive ability info
	passiveAbility: {
		name: string,
		description: string,
		cooldown: number?,
	},
	-- Ultimate skill (unlocked at mastery LV 20)
	ultimateSkill: {
		id: string,
		name: string,
		description: string,
	}?,
}

local ClassTypes = {}

-- Class definitions
ClassTypes.Classes = {
	Normal = {
		id = "Normal",
		name = "Normal",
		description = "à¸ªà¸¡à¸”à¸¸à¸¥à¸—à¸¸à¸à¸”à¹‰à¸²à¸™ à¹€à¸«à¸¡à¸²à¸°à¸ªà¸³à¸«à¸£à¸±à¸šà¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™",
		icon = "âšª",
		color = Color3.fromRGB(220, 220, 220),
		-- Stats
		walkSpeedMod = 1.00, -- normal speed
		jumpPowerMod = 1.00, -- normal jump
		knockbackResistance = 0,
		-- Passive
		passiveAbility = {
			name = "Balanced",
			description = "à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¹„à¸”à¹‰à¹€à¸›à¸£à¸µà¸¢à¸šà¸«à¸£à¸·à¸­à¸‚à¹‰à¸­à¹€à¸ªà¸µà¸¢à¸žà¸´à¹€à¸¨à¸©",
			cooldown = nil,
		},
	},

	Runner = {
		id = "Runner",
		name = "Runner",
		description = "à¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²à¸›à¸à¸•à¸´ à¹à¸•à¹ˆà¸à¸£à¸°à¹‚à¸”à¸”à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²",
		icon = "ðŸƒ",
		color = Color3.fromRGB(100, 200, 255),
		-- Stats
		walkSpeedMod = 1.15, -- +15% speed
		jumpPowerMod = 0.90, -- -10% jump
		knockbackResistance = 0,
		-- Passive
		passiveAbility = {
			name = "Sprint Burst",
			description = "à¸à¸” W à¸ªà¸­à¸‡à¸„à¸£à¸±à¹‰à¸‡à¸•à¸´à¸”à¸à¸±à¸™à¹€à¸žà¸·à¹ˆà¸­ mini boost (cooldown 15 à¸§à¸´)",
			cooldown = 15,
		},
	},
	
	Jumper = {
		id = "Jumper",
		name = "Jumper",
		description = "à¸à¸£à¸°à¹‚à¸”à¸”à¸ªà¸¹à¸‡à¸à¸§à¹ˆà¸²à¸›à¸à¸•à¸´ à¹à¸•à¹ˆà¹€à¸”à¸´à¸™à¸Šà¹‰à¸²à¸à¸§à¹ˆà¸²",
		icon = "ðŸ¦˜",
		color = Color3.fromRGB(100, 255, 100),
		-- Stats
		walkSpeedMod = 0.90, -- -10% speed
		jumpPowerMod = 1.20, -- +20% jump
		knockbackResistance = 0,
		-- Passive
		passiveAbility = {
			name = "Charged Jump",
			description = "à¸à¸” Space à¸„à¹‰à¸²à¸‡à¹€à¸žà¸·à¹ˆà¸­ charged jump (à¸à¸£à¸°à¹‚à¸”à¸”à¸ªà¸¹à¸‡à¸‚à¸¶à¹‰à¸™à¸­à¸µà¸)",
			cooldown = nil, -- no cooldown
		},
	},
	
	Tank = {
		id = "Tank",
		name = "Tank",
		description = "à¸—à¸™à¸•à¹ˆà¸­à¸à¸²à¸£à¸–à¸¹à¸à¹‚à¸ˆà¸¡à¸•à¸µ à¹à¸•à¹ˆà¹€à¸”à¸´à¸™à¸Šà¹‰à¸²à¸à¸§à¹ˆà¸²",
		icon = "ðŸ›¡ï¸",
		color = Color3.fromRGB(255, 200, 100),
		-- Stats
		walkSpeedMod = 0.85, -- -15% speed
		jumpPowerMod = 1.00, -- normal jump
		knockbackResistance = 0.5, -- 50% knockback reduction
		-- Passive
		passiveAbility = {
			name = "Thick Skin",
			description = "à¹„à¸¡à¹ˆà¹‚à¸”à¸™ stun à¸ˆà¸²à¸ items à¸£à¸°à¸”à¸±à¸š Common",
			cooldown = nil,
		},
	},
}

ClassTypes.ClassOrder = {"Normal", "Runner", "Jumper", "Tank"}

-- Default class
ClassTypes.DefaultClass = "Normal"

-- Get class by ID
function ClassTypes.getClass(classId: string): ClassDefinition?
	return ClassTypes.Classes[classId]
end

-- Get all class IDs
function ClassTypes.getAllClassIds(): {string}
	local ids = {}

	for _, id in ipairs(ClassTypes.ClassOrder) do
		if ClassTypes.Classes[id] then
			table.insert(ids, id)
		end
	end

	-- Fallback for any class added outside ClassOrder
	for id, _ in pairs(ClassTypes.Classes) do
		if not table.find(ids, id) then
			table.insert(ids, id)
		end
	end

	return ids
end

-- Get class display info for UI
function ClassTypes.getClassDisplayInfo(classId: string): {
	name: string,
	description: string,
	icon: string,
	color: Color3,
	stats: {string},
	passive: string,
}?
	local classDef = ClassTypes.Classes[classId]
	if not classDef then return nil end
	
	-- Build stats display
	local stats = {}
	
	if classDef.walkSpeedMod ~= 1 then
		local speedPercent = math.floor((classDef.walkSpeedMod - 1) * 100)
		if speedPercent > 0 then
			table.insert(stats, string.format("Speed: +%d%%", speedPercent))
		else
			table.insert(stats, string.format("Speed: %d%%", speedPercent))
		end
	end
	
	if classDef.jumpPowerMod ~= 1 then
		local jumpPercent = math.floor((classDef.jumpPowerMod - 1) * 100)
		if jumpPercent > 0 then
			table.insert(stats, string.format("Jump: +%d%%", jumpPercent))
		else
			table.insert(stats, string.format("Jump: %d%%", jumpPercent))
		end
	end
	
	if classDef.knockbackResistance > 0 then
		local resistPercent = math.floor(classDef.knockbackResistance * 100)
		table.insert(stats, string.format("KB Resist: %d%%", resistPercent))
	end
	
	return {
		name = classDef.name,
		description = classDef.description,
		icon = classDef.icon,
		color = classDef.color,
		stats = stats,
		passive = classDef.passiveAbility.name .. ": " .. classDef.passiveAbility.description,
	}
end

-- Calculate modified stats
function ClassTypes.calculateStats(classId: string, baseWalkSpeed: number, baseJumpPower: number): (number, number)
	local classDef = ClassTypes.Classes[classId]
	if not classDef then
		return baseWalkSpeed, baseJumpPower
	end
	
	local modifiedWalkSpeed = baseWalkSpeed * classDef.walkSpeedMod
	local modifiedJumpPower = baseJumpPower * classDef.jumpPowerMod
	
	return modifiedWalkSpeed, modifiedJumpPower
end

return ClassTypes
